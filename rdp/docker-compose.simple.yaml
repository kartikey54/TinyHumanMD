version: "3.8"

# Simple version using TUNNEL_TOKEN only
# Configure ingress rules in Cloudflare Zero Trust dashboard:
# Networks → Tunnels → Your Tunnel → Configure → Public Hostname
# Add: rdp.yourdomain.com → tcp://localhost:3389

services:
  cloudflared-rdp:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared-rdp
    restart: unless-stopped
    network_mode: host
    command: tunnel --no-autoupdate run
    environment:
      # Using the same tunnel token from cloudflare/docker-compose.yml
      - TUNNEL_TOKEN=eyJhIjoiZWJiZjFkNGU4Yzc1YTcwZjFhYTQ0Njc3ZThiNjI2OWYiLCJ0IjoiZTMyZTU2ZDUtMWM0My00MjNhLTgxZjAtODM1NTZkZGY5ZWMzIiwicyI6Ik1EaGxZVFExWTJZdE1tRmlaaTAwWmpjMUxXSm1NbU10TldSa1pqQm1NMlEyWVRRMSJ9
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

